

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Streams Security &mdash; Apache Kafka 4.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Apache Kafka 4.0.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Developer Guide for Kafka Streams" href="index.html"/>
        <link rel="next" title="Application Reset Tool" href="app-reset-tool.html"/>
        <link rel="prev" title="Managing Streams Application Topics" href="manage-topics.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Apache Kafka
          

          
          </a>

          
            
            
              <div class="version">
                4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../uses.html">Use Cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Apache Kafka Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.html">Kafka APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../design.html">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../implementation.html">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ops.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../connect.html">Kafka Connect</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Kafka Streams</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html">Run Kafka Streams Demo Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html">Tutorial: Write a Kafka Streams Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core-concepts.html">Core Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Developer Guide for Kafka Streams</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="config-streams.html">Configuring a Streams Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="dsl-api.html">Streams DSL</a></li>
<li class="toctree-l4"><a class="reference internal" href="processor-api.html">Processor API</a></li>
<li class="toctree-l4"><a class="reference internal" href="datatypes.html">Data Types and Serialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="interactive-queries.html">Interactive Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="running-app.html">Running Streams Applications</a></li>
<li class="toctree-l4"><a class="reference internal" href="manage-topics.html">Managing Streams Application Topics</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Streams Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="app-reset-tool.html">Application Reset Tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../upgrade-guide.html">Upgrade Guide and API Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#why-you-ll-love-using-kafka-streams">Why you&#8217;ll love using Kafka Streams!</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#kafka-streams-use-cases">Kafka Streams use cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#hello-kafka-streams">Hello Kafka Streams</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Apache Kafka</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Apache Kafka Documentation</a> &raquo;</li>
        
          <li><a href="../index.html">Kafka Streams</a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide for Kafka Streams</a> &raquo;</li>
        
      <li>Streams Security</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/documentation/streams/developer-guide/security.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="streams-security">
<span id="streams-developer-guide-security"></span><h1><a class="reference external" href="#streams-security">Streams Security</a><a class="headerlink" href="#streams-security" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#required-acl-setting-for-secure-kafka-clusters" id="id1">Required ACL setting for secure Kafka clusters</a></li>
<li><a class="reference internal" href="#security-example" id="id2">Security example</a></li>
</ul>
</div>
<p>Kafka Streams natively integrates with the <a class="reference external" href="../../kafka/security.html#kafka-security">Kafka’s security
features</a> and supports all
of the client-side security features in Kafka. Streams leverages the
<a class="reference external" href="../../clients/index.html#kafka-clients">Java Producer and Consumer
API</a>.</p>
<p>To secure your Stream processing applications, configure the security
settings in the corresponding Kafka producer and consumer clients, and
then specify the corresponding configuration settings in your Kafka
Streams application.</p>
<p>Kafka supports cluster encryption and authentication, including a mix of
authenticated and unauthenticated, and encrypted and non-encrypted
clients. Using security is optional.</p>
<p>Here a few relevant client-side security features:</p>
<dl class="docutils">
<dt>Encrypt data-in-transit between your applications and Kafka brokers</dt>
<dd>You can enable the encryption of the client-server communication
between your applications and the Kafka brokers. For example, you
can configure your applications to always use encryption when
reading and writing data to and from Kafka. This is critical when
reading and writing data across security domains such as internal
network, public internet, and partner networks.</dd>
<dt>Client authentication</dt>
<dd>You can enable client authentication for connections from your
application to Kafka brokers. For example, you can define that only
specific applications are allowed to connect to your Kafka cluster.</dd>
<dt>Client authorization</dt>
<dd>You can enable client authorization of read and write operations by
your applications. For example, you can define that only specific
applications are allowed to read from a Kafka topic. You can also
restrict write access to Kafka topics to prevent data pollution or
fraudulent activities.</dd>
</dl>
<p>For more information about the security features in Apache Kafka, see
<a class="reference external" href="../../kafka/security.html#kafka-security">Kafka Security</a>.</p>
<div class="section" id="required-acl-setting-for-secure-kafka-clusters">
<h2><a class="reference external" href="#required-acl-setting-for-secure-kafka-clusters">Required ACL setting for secure Kafka clusters</a><a class="headerlink" href="#required-acl-setting-for-secure-kafka-clusters" title="Permalink to this headline">¶</a></h2>
<p>When applications are run against a secured Kafka cluster, the principal
running the application must have the ACL
<code class="docutils literal"><span class="pre">--cluster</span> <span class="pre">--operation</span> <span class="pre">Create</span></code> set so that the application has the
permissions to create <a class="reference external" href="manage-topics.html#streams-developer-guide-topics-internal">internal
topics</a>.</p>
</div>
<div class="section" id="security-example">
<h2><a class="reference external" href="#security-example">Security example</a><a class="headerlink" href="#security-example" title="Permalink to this headline">¶</a></h2>
<p>The purpose is to configure a Kafka Streams application to enable client
authentication and encrypt data-in-transit when communicating with its
Kafka cluster.</p>
<p>This example assumes that the Kafka brokers in the cluster already have
their security setup and that the necessary SSL certificates are
available to the application in the local filesystem locations. For
example, if you are using Docker then you must also include these SSL
certificates in the correct locations within the Docker image.</p>
<p>The snippet below shows the settings to enable client authentication and
SSL encryption for data-in-transit between your Kafka Streams
application and the Kafka cluster it is reading and writing from:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Essential security settings to enable client authentication and SSL encryption</span>
<span class="n">bootstrap</span><span class="o">.</span><span class="n">servers</span><span class="o">=</span><span class="n">kafka</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">9093</span>
<span class="n">security</span><span class="o">.</span><span class="n">protocol</span><span class="o">=</span><span class="n">SSL</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">truststore</span><span class="o">.</span><span class="n">location</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">security</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">kafka</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">truststore</span><span class="o">.</span><span class="n">jks</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">truststore</span><span class="o">.</span><span class="n">password</span><span class="o">=</span><span class="n">test1234</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">keystore</span><span class="o">.</span><span class="n">location</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">security</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">kafka</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">keystore</span><span class="o">.</span><span class="n">jks</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">keystore</span><span class="o">.</span><span class="n">password</span><span class="o">=</span><span class="n">test1234</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">password</span><span class="o">=</span><span class="n">test1234</span>
</pre></div>
</div>
<p>Configure these settings in the application for your <code class="docutils literal"><span class="pre">StreamsConfig</span></code>
instance. These settings will encrypt any data-in-transit that is being
read from or written to Kafka, and your application will authenticate
itself against the Kafka brokers that it is communicating with. Note
that this example does not cover client authorization.</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Code</span> <span class="n">of</span> <span class="n">your</span> <span class="n">Java</span> <span class="n">application</span> <span class="n">that</span> <span class="n">uses</span> <span class="n">the</span> <span class="n">Kafka</span> <span class="n">Streams</span> <span class="n">library</span>
<span class="n">Properties</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Properties</span><span class="p">();</span>
<span class="n">settings</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">StreamsConfig</span><span class="o">.</span><span class="n">APPLICATION_ID_CONFIG</span><span class="p">,</span> <span class="s2">&quot;secure-kafka-streams-app&quot;</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Where</span> <span class="n">to</span> <span class="n">find</span> <span class="n">secure</span> <span class="n">Kafka</span> <span class="n">brokers</span><span class="o">.</span>  <span class="n">Here</span><span class="p">,</span> <span class="n">it</span><span class="s1">&#39;s on port 9093.</span>
<span class="n">settings</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">StreamsConfig</span><span class="o">.</span><span class="n">BOOTSTRAP_SERVERS_CONFIG</span><span class="p">,</span> <span class="s2">&quot;kafka.example.com:9093&quot;</span><span class="p">);</span>
<span class="o">//</span>
<span class="o">//</span> <span class="o">...</span><span class="n">further</span> <span class="n">non</span><span class="o">-</span><span class="n">security</span> <span class="n">related</span> <span class="n">settings</span> <span class="n">may</span> <span class="n">follow</span> <span class="n">here</span><span class="o">...</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">Security</span> <span class="n">settings</span><span class="o">.</span>
<span class="o">//</span> <span class="mf">1.</span> <span class="n">These</span> <span class="n">settings</span> <span class="n">must</span> <span class="n">match</span> <span class="n">the</span> <span class="n">security</span> <span class="n">settings</span> <span class="n">of</span> <span class="n">the</span> <span class="n">secure</span> <span class="n">Kafka</span> <span class="n">cluster</span><span class="o">.</span>
<span class="o">//</span> <span class="mf">2.</span> <span class="n">The</span> <span class="n">SSL</span> <span class="n">trust</span> <span class="n">store</span> <span class="ow">and</span> <span class="n">key</span> <span class="n">store</span> <span class="n">files</span> <span class="n">must</span> <span class="n">be</span> <span class="n">locally</span> <span class="n">accessible</span> <span class="n">to</span> <span class="n">the</span> <span class="n">application</span><span class="o">.</span>
<span class="n">settings</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">CommonClientConfigs</span><span class="o">.</span><span class="n">SECURITY_PROTOCOL_CONFIG</span><span class="p">,</span> <span class="s2">&quot;SSL&quot;</span><span class="p">);</span>
<span class="n">settings</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">SslConfigs</span><span class="o">.</span><span class="n">SSL_TRUSTSTORE_LOCATION_CONFIG</span><span class="p">,</span> <span class="s2">&quot;/etc/security/tls/kafka.client.truststore.jks&quot;</span><span class="p">);</span>
<span class="n">settings</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">SslConfigs</span><span class="o">.</span><span class="n">SSL_TRUSTSTORE_PASSWORD_CONFIG</span><span class="p">,</span> <span class="s2">&quot;test1234&quot;</span><span class="p">);</span>
<span class="n">settings</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">SslConfigs</span><span class="o">.</span><span class="n">SSL_KEYSTORE_LOCATION_CONFIG</span><span class="p">,</span> <span class="s2">&quot;/etc/security/tls/kafka.client.keystore.jks&quot;</span><span class="p">);</span>
<span class="n">settings</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">SslConfigs</span><span class="o">.</span><span class="n">SSL_KEYSTORE_PASSWORD_CONFIG</span><span class="p">,</span> <span class="s2">&quot;test1234&quot;</span><span class="p">);</span>
<span class="n">settings</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">SslConfigs</span><span class="o">.</span><span class="n">SSL_KEY_PASSWORD_CONFIG</span><span class="p">,</span> <span class="s2">&quot;test1234&quot;</span><span class="p">);</span>
<span class="n">StreamsConfig</span> <span class="n">streamsConfiguration</span> <span class="o">=</span> <span class="n">new</span> <span class="n">StreamsConfig</span><span class="p">(</span><span class="n">settings</span><span class="p">);</span>
</pre></div>
</div>
<p>If you incorrectly configure a security setting in your application, it
will fail at runtime, typically right after you start it. For example,
if you enter an incorrect password for the <code class="docutils literal"><span class="pre">ssl.keystore.password</span></code>
setting, an error message similar to this would be logged and then the
application would terminate:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Misconfigured ssl.keystore.password</span>
<span class="ne">Exception</span> <span class="ow">in</span> <span class="n">thread</span> <span class="s2">&quot;main&quot;</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">KafkaException</span><span class="p">:</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">construct</span> <span class="n">kafka</span> <span class="n">producer</span>
<span class="p">[</span><span class="o">...</span><span class="n">snip</span><span class="o">...</span><span class="p">]</span>
<span class="n">Caused</span> <span class="n">by</span><span class="p">:</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">KafkaException</span><span class="p">:</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">KafkaException</span><span class="p">:</span>
   <span class="n">java</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">IOException</span><span class="p">:</span> <span class="n">Keystore</span> <span class="n">was</span> <span class="n">tampered</span> <span class="k">with</span><span class="p">,</span> <span class="ow">or</span> <span class="n">password</span> <span class="n">was</span> <span class="n">incorrect</span>
<span class="p">[</span><span class="o">...</span><span class="n">snip</span><span class="o">...</span><span class="p">]</span>
<span class="n">Caused</span> <span class="n">by</span><span class="p">:</span> <span class="n">java</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">UnrecoverableKeyException</span><span class="p">:</span> <span class="n">Password</span> <span class="n">verification</span> <span class="n">failed</span>
</pre></div>
</div>
<p>Monitor your Kafka Streams application log files for such error messages
to spot any misconfigured applications quickly.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="app-reset-tool.html" class="btn btn-neutral float-right" title="Application Reset Tool" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="manage-topics.html" class="btn btn-neutral" title="Managing Streams Application Topics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Software Foundation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'4.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>