

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing a Streams Application &mdash; Apache Kafka 4.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Apache Kafka 4.0.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Developer Guide for Kafka Streams" href="index.html"/>
        <link rel="next" title="Configuring a Streams Application" href="config-streams.html"/>
        <link rel="prev" title="Developer Guide for Kafka Streams" href="index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Apache Kafka
          

          
          </a>

          
            
            
              <div class="version">
                4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../uses.html">Use Cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Apache Kafka Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api.html">Kafka APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../design.html">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../implementation.html">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ops.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../connect.html">Kafka Connect</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Kafka Streams</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../quickstart.html">Run Kafka Streams Demo Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html">Tutorial: Write a Kafka Streams Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core-concepts.html">Core Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Developer Guide for Kafka Streams</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Writing a Streams Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="config-streams.html">Configuring a Streams Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="dsl-api.html">Streams DSL</a></li>
<li class="toctree-l4"><a class="reference internal" href="processor-api.html">Processor API</a></li>
<li class="toctree-l4"><a class="reference internal" href="datatypes.html">Data Types and Serialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="interactive-queries.html">Interactive Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="running-app.html">Running Streams Applications</a></li>
<li class="toctree-l4"><a class="reference internal" href="manage-topics.html">Managing Streams Application Topics</a></li>
<li class="toctree-l4"><a class="reference internal" href="security.html">Streams Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="app-reset-tool.html">Application Reset Tool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../upgrade-guide.html">Upgrade Guide and API Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#why-you-ll-love-using-kafka-streams">Why you&#8217;ll love using Kafka Streams!</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#kafka-streams-use-cases">Kafka Streams use cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#hello-kafka-streams">Hello Kafka Streams</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Apache Kafka</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Apache Kafka Documentation</a> &raquo;</li>
        
          <li><a href="../index.html">Kafka Streams</a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide for Kafka Streams</a> &raquo;</li>
        
      <li>Writing a Streams Application</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/documentation/streams/developer-guide/write-streams.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-a-streams-application">
<span id="streams-write-app"></span><h1><a class="reference external" href="#writing-a-streams-application">Writing a Streams Application</a><a class="headerlink" href="#writing-a-streams-application" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#libraries-and-maven-artifacts" id="id1">Libraries and Maven artifacts</a></li>
<li><a class="reference internal" href="#using-kafka-streams-within-your-application" id="id2">Using Kafka Streams within your application</a></li>
</ul>
</div>
<p>Any Java application that makes use of the Kafka Streams library is
considered a Kafka Streams application. The computational logic of a
Kafka Streams application is defined as a <a class="reference external" href="../concepts.html#streams-concepts">processor
topology</a>, which is a graph of
stream processors (nodes) and streams (edges).</p>
<p>You can define the processor topology with the Kafka Streams APIs:</p>
<dl class="docutils">
<dt><a class="reference external" href="dsl-api.html#streams-developer-guide-dsl">Kafka Streams DSL</a></dt>
<dd>A high-level API that provides provides the most common data
transformation operations such as <code class="docutils literal"><span class="pre">map</span></code>, <code class="docutils literal"><span class="pre">filter</span></code>, <code class="docutils literal"><span class="pre">join</span></code>, and
<code class="docutils literal"><span class="pre">aggregations</span></code> out of the box. The DSL is the recommended starting
point for developers new to Kafka Streams, and should cover many use
cases and stream processing needs.</dd>
<dt><a class="reference external" href="processor-api.html#streams-developer-guide-processor-api">Processor API</a></dt>
<dd>A low-level API that lets you add and connect processors as well as
interact directly with state stores. The Processor API provides you
with even more flexibility than the DSL but at the expense of
requiring more manual work on the side of the application developer
(e.g., more lines of code).</dd>
</dl>
<div class="section" id="libraries-and-maven-artifacts">
<h2><a class="toc-backref" href="#id1">Libraries and Maven artifacts</a><a class="headerlink" href="#libraries-and-maven-artifacts" title="Permalink to this headline">¶</a></h2>
<p>This section lists the Kafka Streams related libraries that are
available for writing your Kafka Streams applications.</p>
<p>You can define dependencies on the following libraries for your Kafka
Streams applications.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="18%" />
<col width="11%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Group
ID</th>
<th class="head">Artifact
ID</th>
<th class="head">Versi
on</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">org.a</span>
<span class="pre">pache.k</span>
<span class="pre">afka</span></code></td>
<td><code class="docutils literal"><span class="pre">kafka-st</span>
<span class="pre">reams</span></code></td>
<td><code class="docutils literal"><span class="pre">1.0</span>
<span class="pre">.0</span></code></td>
<td>(Required) Base library for Kafka
Streams.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">org.a</span>
<span class="pre">pache.k</span>
<span class="pre">afka</span></code></td>
<td><code class="docutils literal"><span class="pre">kafka-cl</span>
<span class="pre">ients</span></code></td>
<td><code class="docutils literal"><span class="pre">1.0</span>
<span class="pre">.0</span></code></td>
<td>(Required) Kafka client library.
Contains built-in
serializers/deserializers.</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">See the section <a class="reference external" href="datatypes.html#streams-developer-guide-serdes">Data Types and
Serialization</a> for
more information about Serializers/Deserializers.</p>
</div>
<p>Example <code class="docutils literal"><span class="pre">pom.xml</span></code> snippet when using Maven:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">kafka</span><span class="o">-</span><span class="n">streams</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">kafka</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">kafka</span><span class="o">-</span><span class="n">clients</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="using-kafka-streams-within-your-application">
<h2><a class="toc-backref" href="#id2">Using Kafka Streams within your application</a><a class="headerlink" href="#using-kafka-streams-within-your-application" title="Permalink to this headline">¶</a></h2>
<p>You can call Kafka Streams from anywhere in your application code, but
usually these calls are made within the <code class="docutils literal"><span class="pre">main()</span></code> method of your
application, or some variant thereof. The basic elements of defining a
processing topology within your application are described below.</p>
<p>First, you must create an instance of <code class="docutils literal"><span class="pre">KafkaStreams</span></code>.</p>
<ul class="simple">
<li>The first argument of the <code class="docutils literal"><span class="pre">KafkaStreams</span></code> constructor takes a
topology (either <code class="docutils literal"><span class="pre">StreamsBuilder#build()</span></code> for the
<a class="reference external" href="dsl-api.html#streams-developer-guide-dsl">DSL</a> or <code class="docutils literal"><span class="pre">Topology</span></code>
for the <a class="reference external" href="processor-api.html#streams-developer-guide-processor-api">Processor
API</a>)
that is used to define a topology.</li>
<li>The second argument is an instance of <code class="docutils literal"><span class="pre">StreamsConfig</span></code>, which
defines the configuration for this specific topology.</li>
</ul>
<p>Code example:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.kafka.streams.KafkaStreams</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.kafka.streams.StreamsConfig</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.kafka.streams.kstream.StreamsBuilder</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.kafka.streams.processor.Topology</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">builders</span> <span class="n">to</span> <span class="n">define</span> <span class="n">the</span> <span class="n">actual</span> <span class="n">processing</span> <span class="n">topology</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">to</span> <span class="n">specify</span>
<span class="o">//</span> <span class="kn">from</span> <span class="nn">which</span> <span class="nb">input</span> <span class="n">topics</span> <span class="n">to</span> <span class="n">read</span><span class="p">,</span> <span class="n">which</span> <span class="n">stream</span> <span class="n">operations</span> <span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span><span class="p">)</span>
<span class="o">//</span> <span class="n">should</span> <span class="n">be</span> <span class="n">called</span><span class="p">,</span> <span class="ow">and</span> <span class="n">so</span> <span class="n">on</span><span class="o">.</span>  <span class="n">We</span> <span class="n">will</span> <span class="n">cover</span> <span class="n">this</span> <span class="ow">in</span> <span class="n">detail</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">subsequent</span>
<span class="o">//</span> <span class="n">sections</span> <span class="n">of</span> <span class="n">this</span> <span class="n">Developer</span> <span class="n">Guide</span><span class="o">.</span>

<span class="n">StreamsBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>  <span class="o">//</span> <span class="n">when</span> <span class="n">using</span> <span class="n">the</span> <span class="n">DSL</span>
<span class="n">Topology</span> <span class="n">topology</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">();</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">OR</span>
<span class="o">//</span>
<span class="n">Topology</span> <span class="n">topology</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span> <span class="o">//</span> <span class="n">when</span> <span class="n">using</span> <span class="n">the</span> <span class="n">Processor</span> <span class="n">API</span>

<span class="o">//</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">configuration</span> <span class="n">to</span> <span class="n">tell</span> <span class="n">your</span> <span class="n">application</span> <span class="n">where</span> <span class="n">the</span> <span class="n">Kafka</span> <span class="n">cluster</span> <span class="ow">is</span><span class="p">,</span>
<span class="o">//</span> <span class="n">which</span> <span class="n">Serializers</span><span class="o">/</span><span class="n">Deserializers</span> <span class="n">to</span> <span class="n">use</span> <span class="n">by</span> <span class="n">default</span><span class="p">,</span> <span class="n">to</span> <span class="n">specify</span> <span class="n">security</span> <span class="n">settings</span><span class="p">,</span>
<span class="o">//</span> <span class="ow">and</span> <span class="n">so</span> <span class="n">on</span><span class="o">.</span>
<span class="n">StreamsConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>

<span class="n">KafkaStreams</span> <span class="n">streams</span> <span class="o">=</span> <span class="n">new</span> <span class="n">KafkaStreams</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span>
</pre></div>
</div>
<p>At this point, internal structures are initialized, but the processing
is not started yet. You have to explicitly start the Kafka Streams
thread by calling the <code class="docutils literal"><span class="pre">KafkaStreams#start()</span></code> method:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Start</span> <span class="n">the</span> <span class="n">Kafka</span> <span class="n">Streams</span> <span class="n">threads</span>
<span class="n">streams</span><span class="o">.</span><span class="n">start</span><span class="p">();</span>
</pre></div>
</div>
<p>If there are other instances of this stream processing application
running elsewhere (e.g., on another machine), Kafka Streams
transparently re-assigns tasks from the existing instances to the new
instance that you just started. For more information, see <a class="reference external" href="../architecture.html#streams-architecture-tasks">Stream
Partitions and
Tasks</a> and
<a class="reference external" href="../architecture.html#streams-architecture-threads">Threading Model</a>.</p>
<p>To catch any unexpected exceptions, you can set an
<code class="docutils literal"><span class="pre">java.lang.Thread.UncaughtExceptionHandler</span></code> before you start the
application. This handler is called whenever a stream thread is
terminated by an unexpected exception:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>// Java 8+, using lambda expressions
streams.setUncaughtExceptionHandler((Thread thread, Throwable throwable) -&gt; {
  // here you should examine the throwable/exception and perform an appropriate action!
});


// Java 7
streams.setUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {
  public void uncaughtException(Thread thread, Throwable throwable) {
    // here you should examine the throwable/exception and perform an appropriate action!
  }
});
</pre></div>
</div>
<p>To stop the application instance, call the <code class="docutils literal"><span class="pre">KafkaStreams#close()</span></code>
method:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Stop</span> <span class="n">the</span> <span class="n">Kafka</span> <span class="n">Streams</span> <span class="n">threads</span>
<span class="n">streams</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
</pre></div>
</div>
<p>To allow your application to gracefully shutdown in response to SIGTERM,
it is recommended that you add a shutdown hook and call
<code class="docutils literal"><span class="pre">KafkaStreams#close</span></code>.</p>
<ul>
<li><p class="first">Here is a shutdown hook example in Java 8+:</p>
<blockquote>
<div><div class="code bash highlight-default"><div class="highlight"><pre><span></span>// Add shutdown hook to stop the Kafka Streams threads.
// You can optionally provide a timeout to `close`.
Runtime.getRuntime().addShutdownHook(new Thread(streams::close));
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Here is a shutdown hook example in Java 7:</p>
<blockquote>
<div><div class="code bash highlight-default"><div class="highlight"><pre><span></span>// Add shutdown hook to stop the Kafka Streams threads.
// You can optionally provide a timeout to `close`.
Runtime.getRuntime().addShutdownHook(new Thread(new Runnable() {
  @Override
  public void run() {
      streams.close();
  }
}));
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>After an application is stopped, Kafka Streams will migrate any tasks
that had been running in this instance to available remaining instances.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="config-streams.html" class="btn btn-neutral float-right" title="Configuring a Streams Application" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Developer Guide for Kafka Streams" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Software Foundation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'4.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>